syntax = "proto3";

message Product {
    int32   id          = 1;
    int32   company_id  = 2;
    string  name        = 3;
}

message Code {
    string  message         = 1;
    int32   company_id      = 2;
    int64   created_at      = 3;
    int64   activated_at    = 4;
    Product product         = 5;
    Roast   roast           = 6;
}

message Certification { 
    string name     = 1;
    string hash     = 2;
    uint32 size     = 3;
    string url      = 4;
}

message Farm {
    string id       = 1;
    string name     = 2;        
    repeated Certification certifications = 3;    
}

message Location {
    float       lat         = 1;
    float       lng         = 2;
    string      description = 3;
}

message Harvest {
    string      id       = 1;
    uint32      year     = 2;
    uint32      month    = 3;    
    Location    location = 5;
}

message Shipment {
    string      id          = 1;
    Harvest     harvest     = 2;
    Location    source      = 3;
    Location    destination = 4;
    int64       shipped_at  = 5;
    int64       recieved_at = 6;
}

message Roast {
    int64       roasted_at  = 1;
    Location    location    = 2;
    repeated 
        Harvest harvests = 3;    
}

message Events {
    message MintCode {
        string message = 1;
        int64 created_at = 2;
    }

    message ActivateCode {
        string message = 1;
        int64 timestamp = 2;
    }
}

message CoffeeChainEvents {
    oneof payload {
        Events.MintCode     mint_code       = 1;
        Events.ActivateCode activate_code   = 2;
        Certification       cert_create     = 3;
        Harvest             harvest_create  = 4;
        Farm                farm_create     = 5;
    }
}